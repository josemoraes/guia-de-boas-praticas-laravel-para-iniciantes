<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia de Boas Pr√°ticas - Laravel</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GFD5NFN3HV"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-GFD5NFN3HV');
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Anton&family=Nunito+Sans:wght@300;400;900&family=Ubuntu:wght@300;400;700&display=swap"
        rel="stylesheet">
    <style>
        * {
            font-family: 'Nunito Sans', sans-serif;
        }
    </style>
</head>

<body class="py-10 bg-gray-100 flex flex-col items-center justify-center">
    <header class="w-8/12">
        <h1 class="text-5xl font-bold text-red-500">Guia de Boas Pr√°ticas com Laravel</h1>
        <h2 class="text-2xl font-bold text-gray-500">( para iniciantes )</h2>
    </header>
    <main class="w-8/12">
        <section class="my-10">
            <article class="text-lg leading-relaxed">
                <p>Ol√°, Dev!</p>
                <p>Suponho que voc√™ seja um iniciante na √°rea de programa√ß√£o. Logo, me arrisco a dizer que na maior
                    parte do tempo em que voc√™ est√° dedicado √† aprender mais sobre a √°rea, est√° sempre √† procura de qual
                    a nova tend√™ncia, ferramenta, ou tecnologia precisa aprender para conseguir se destacar.</p>
                <p>E se te disser que isso √© besteira?</p>
                <p>Com o passar dos anos, a experi√™ncia e a exposi√ß√£o √† ambientes desafiadores te mostram que os
                    fundamentos s√£o muito mais importantes que qualquer nova tend√™ncia atual.</p>
                <p>Manter um software √© muito mais trabalhoso, do que criar um do zero. Talvez seja por isso, que tenho
                    certeza que j√° deve ter ouvido, ou dito algo parecido com: </p>
                <blockquote class="border-l-4 border-red-400 bg-gray-200 my-2 p-3 italic">‚ÄúE se a gente refizesse isso
                    com <strong>[coloque aqui qual a tecnologia da moda]</strong>?‚Äù</blockquote>
                <p>No que Eu acredito? Que software bom, √© aquele que √© usado. Tecnologia boa √© qualquer uma que resolve
                    o seu problema, ali√°s, o que √© uma linguagem, ou framework sen√£o mais uma ferramenta no que deveria
                    ser a sua caixa de ferramentas? </p>
                <blockquote class="border-l-4 border-red-400 bg-gray-200 my-2 p-3 italic">Acredito que o bom c√≥digo √©
                    aquele que possui uma leitura e entendimento simples e √≥bvio. Que permita uma f√°cil manuten√ß√£o e
                    evolu√ß√£o.</blockquote>
                <p>Por isso, esse material ser√° focado em ajudar voc√™, desenvolvedor Laravel, a parar de buscar
                    alternativas em outras linguagens, ou frameworks, sem antes ter explorado o que o Laravel tem de
                    melhor a te oferecer. Construindo softwares com alta manutenabilidade e extensibilidade.</p>
                <p>Portanto, o conte√∫do que voc√™ vai encontrar aqui ser√° claro e direto. Voc√™ dever√° us√°-lo como mais
                    uma ferramenta no seu arsenal. Sendo assim, voc√™ pode acessar diretamente as se√ß√µes de interesse,
                    sem ter que ler as anteriores.</p>
                <p>Meu objetivo √© que Voc√™ seja visto como um excelente profissional, que aplica boas pr√°ticas e escreve
                    um c√≥digo com alto n√≠vel de manutenabilidade.</p>
            </article>
            <article class="border-l-4 border-red-400 bg-gray-200 my-2 p-3 leading-relaxed">
                <h3 class="text-xl font-bold">Quem criou essa p√°gina?</h3>
                <p>Ol√°, me chamo Jos√© Moraes e j√° atuo na √°rea de software h√° alguns anos.</p>
                <p>Caso tenha interesse em saber mais sobre mim, recomendo se conectar comigo pelo LinkedIn e visitar
                    meu Github</p>
                <ul class="mt-3 flex flex-row">
                    <li><a href="https://www.linkedin.com/in/josecarlosfilho/"
                            class="bg-blue-600 px-3 py-2 border-2 border-blue-500 rounded text-white font-bold mr-3 block w-28 text-center">LinkedIn</a>
                    </li>
                    <li><a href="https://github.com/josemoraes"
                            class="bg-black px-3 py-2 border-2 border-gray-800 rounded text-white font-bold block w-28 text-center">Github</a>
                    </li>
                </ul>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left"
            data-card-name="sua-responsabilidade-e-uma-so">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Sua
                responsabilidade √© uma s√≥<span class="show-details text-gray-500 text-lg" role="button">exibir</span>
            </h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>J√° ouviu aquele ditado: <i>‚ÄúQuem faz tudo, n√£o faz nada bem feito‚Äù</i>?</p>
                <p>Pois √©, o famoso <strong>Princ√≠pio de Responsabilidade √önica</strong> trata justamente disso. Suas
                    classes e fun√ß√µes devem ter uma √∫nica responsabilidade. Ao fazer isso, a escrita de testes fica mais
                    f√°cil, e o processo de ‚Äúdebuga√ß√£o‚Äù tamb√©m.</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© ruim</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
protected function fullClientName(): Attribute
{
    if (auth()->user() && auth()->user()->hasRole('client') && auth()->user()->isVerified()) {
        return new Attribute(
            get: fn ($value, $attributes) => "Sr. $attributes['first_name'] $attributes['middle_name'] $attributes['last_name']",
        );
    } else {
        return new Attribute(
            get: fn ($value, $attributes) => "$attributes['first_name'] $attributes['last_name']",
        );
    }
}
</pre>
                <p>Os problemas do c√≥digo acima s√£o:</p>
                <ul class="list-disc pl-6">
                    <li>Muito verboso. Parece bagun√ßado; e</li>
                    <li>Em uma breve leitura voc√™ percebe que ele valida se o usu√°rio est√° ‚Äúlogado‚Äù, se seu papel √©
                        <i>client</i> e se ele est√° verificado. O que n√£o tem nada haver com o nome do cliente;</li>
                </ul>
                <p>√Ä partir do momento em que o c√≥digo faz mais do que apenas retornar o nome do usu√°rio (que √© o que
                    diz o nome da fun√ß√£o), o c√≥digo esconde de quem o chama, regras de neg√≥cio que n√£o tem nada haver
                    com o que o consumidor da fun√ß√£o (uma outra classe por exemplo) espera. Na verdade, isso afetaria
                    at√© a escrita de testes unit√°rios, uma vez que a estrat√©gia de defini√ß√£o de como ser√° retornado o
                    nome est√° escondida dentro da fun√ß√£o.</p>
                <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
protected function fullClientName() : Attribute
{
    return new Attribute(
            get: fn ($value, $attributes) => "Sr. $attributes['first_name'] $attributes['middle_name'] $attributes['last_name']",
        );
}

protected function shortClientName() : Attribute
{
    return new Attribute(
            get: fn ($value, $attributes) => "$attributes['first_name'] $attributes['last_name']",
        );
}

public function isTheLoggedUserAVerifiedClient()
{
    return  auth()->user() && 
            auth()->user()->hasRole('client') && 
            auth()->user()->isVerified()	
}

public function getUserData() 
{
    // Essa seria uma fun√ß√£o qualquer que consumiria as demais
    $name = $user->isTheLoggedUserAVerifiedClient() 
                ? $user->full_client_name 
                : $user->short_client_name;

    return new UserDTO($name, ...);
}
</pre>
                <p>Veja que nessa segunda abordagem, √© retornado exatamente o valor que a fun√ß√£o <i>getUserData</i>
                    espera quando pede pelo nome longo do cliente (<i>full_client_name</i>), ou a vers√£o curta dele
                    (<i>short_client_name</i>). √â a fun√ß√£o chamadora quem define se quer exibir o nome curto, ou
                    completo. Dessa forma, nenhuma regra de neg√≥cio fica oculta dentro de um m√©todo que s√≥ deveria
                    retornar um nome na vers√£o longa, ou curta.</p>
                <p>Uma dica √© sempre usar nomes descritivos, que realmente digam o que a fun√ß√£o/classe faz. Desse jeito,
                    se voc√™ notar que o nome atribu√≠do come√ßa a ficar longo e dizer que faz mais do que o que voc√™ pensa
                    que ela deveria fazer, isso √© sintoma de que o c√≥digo em quest√£o est√° ferindo o <strong>Princ√≠pio de
                        Responsabilidade √önica</strong>.</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left"
            data-card-name="controllers-devem-ser-finas">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">
                Controllers devem ser "finas"<span class="show-details text-gray-500 text-lg"
                    role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>Existe uma express√£o na comunidade Laravel que diz (em tradu√ß√£o livre):</p>
                <blockquote class="border-l-4 border-red-400 bg-gray-200 my-2 p-3 italic">Tenha models ‚Äúgordos‚Äù e
                    controllers ‚Äúfinos‚Äù</blockquote>
                <p>Na pr√°tica, isso quer dizer que voc√™ n√£o deve ter regras de neg√≥cio, nem consultas de banco nas suas
                    controllers.</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© ruim</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
public function index()
{
    $users = User::verified()
        ->with(['posts' => function ($q) {
            $q->where('created_at', '>', Carbon::today()->subWeek());
        }])
        ->get();

    return view('index', ['users' => $users]);
}
</pre>
                <p>Veja que toda a defini√ß√£o de consulta est√° definida na controller. Isso √© p√©ssimo, pois cruza as
                    fronteiras de responsabilidade de uma controller, que deve apenas direcionar a model/regra de
                    neg√≥cio que ser√° entregue para a camada de apresenta√ß√£o.</p>
                <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
// Na Controller
public function index()
{
    return view('index', ['users' => $this->user->getWithNewPosts()]);
}

// Na Model
class Client extends Model
{
    public function getWithNewPosts()
    {
        return $this->verified()
            ->with(['posts' => function ($q) {
                $q->where('created_at', '>', Carbon::today()->subWeek());
            }])
            ->get();
    }
}
</pre>
                <p>Perceba que agora a controller apenas indica que os usu√°rios a serem apresentados devem possuir os
                    <i>posts</i> mais recentes, sem se importar como isso √© feito na model.</p>
                <p>Isso vai manter seu c√≥digo muito mais organizado e leg√≠vel.</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left"
            data-card-name="valide-suas-requisicoes-do-jeito-certo">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Valide
                suas requisi√ß√µes do jeito certo<span class="show-details text-gray-500 text-lg"
                    role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>Se voc√™ estiver validando as requisi√ß√µes diretamente na controller, pare agora mesmo. Lembre-se:
                    <i>‚ÄúControllers sempre finas‚Äù</i>. Portanto:</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© ruim</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
public function store(Request $request)
{
    $request->validate([
        'name' => 'required|max:255',
        'description' => 'required'
    ]);
    ...
}
</pre>
                <p>A classe <i>Request</i> pode ser estendida e customizada para que contenha as valida√ß√µes que deseja
                    fazer.</p>
                <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
// Crie a classe para extender Request e tratar as valida√ß√µes
class ProductRequest extends Request
{
    public function rules()
    {
        return [
            'name' => 'required|max:255',
                'description' => 'required'
        ];
    }
}

// Aqui √© na classe de Controller
public function store(ProductRequest $request)
{
    ....
}
</pre>
                <p>Agora sim üòÉ</p>
                <p>Veja que as regras agora s√£o definidas dentro da fun√ß√£o <i>rules</i> da classe <i>ProductRequest</i>
                    e o pr√≥prio middleware as executa antes de passar a requisi√ß√£o para a controller em si. Se alguma
                    regra for ferida, o middleware disparar√° uma exce√ß√£o.</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left"
            data-card-name="ja-diziam-os-menudos-nao-se-repita">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">J√°
                diziam os Menudos: "N√£o se repita"<span class="show-details text-gray-500 text-lg"
                    role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>Tenho certeza que essa m√∫sica vai ficar na sua cabe√ßa pelo resto do seu dia: <i>‚ÄúN√£o se repita, n√£o
                        se repita (‚Ä¶)‚Äù</i>.</p>
                <p>O conceito de DRY (Dont Repeat Yourself - N√£o se Repita) parece √≥bvio, ali√°s, quem gosta de escrever
                    o mesmo c√≥digo em v√°rios lugares diferentes, sem reaproveitar nada? ü§®</p>
                <p>Desculpa estragar seu sorrisinho de canto de boca, mas <strong>CTRL + C</strong> e <strong>CTRL +
                        V</strong> n√£o √© bem reaproveitamento de c√≥digo no conceito DRY.</p>
                <p>A verdade √© que <i>‚ÄúN√£o se Repetir‚Äù</i> aqui √© abstrair alguma l√≥gica em um escopo com fronteiras bem
                    definidas e acessar esse escopo por uma inst√¢ncia dele. Veja:</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© ruim</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
public function getActive()
{
    return $this->where('verified', 1)->get();
}

public function getPosts()
{
    return $this->whereHas('user', function ($q) {
            $q->where('verified', 1);
        })->get();
}
</pre>
                <p>Veja que nas duas fun√ß√µes, √© feita uma query para verificar se o usu√°rio foi verificado.</p>
                <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
public function scopeVerified($q)
{
    return $q->where('verified', 1);
}

public function getActive()
{
    return $this->verified()->get();
}

public function getArticles()
{
    return $this->whereHas('user', function ($q) {
            $q->verified();
        })->get();
}
</pre>
                <p>Veja que aqui, usei o conceito de query scopes (escopos de consulta) do Eloquent ORM usado pelo
                    Laravel, e abstra√≠ a l√≥gica de consulta que aplica o filtro de usu√°rio verificado e apenas
                    reaproveitei o uso do escopo nas demais fun√ß√µes.</p>
                <p>Vale lembrar que aqui s√≥ usei o conceito de query scopes, para aproveitar a oportunidade de mostrar
                    como eles funcionam e explicar o conceito ao mesmo tempo, por√©m, o conceito de DRY deve ser aplicado
                    toda vez que voc√™ perceber que um mesmo trecho de c√≥digo est√° sendo usado em outros lugares. Se voc√™
                    estiver fazendo muito <strong>CTRL + C</strong> e <strong>CTRL + V</strong> de um trecho de c√≥digo,
                    certamente √© uma oportunidade clara de aplicar o DRY.</p>
                <p>Fique sempre atento e refatore quando necess√°rio.</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left"
            data-card-name="coloque-um-nome-decente">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Coloque
                um nome decente!<span class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>Isso aqui vem direto dos ensinamentos do Uncle Bob (Robert C. Martin). Use sempre nomes expressivos
                    em vari√°veis, fun√ß√µes, classes, constantes, e assim por diante.</p>
                <p>Nomes expressivos v√£o tornar seu c√≥digo √≥bvio e simples de ser lido. E no mundo do c√≥digo, ser
                    simples √© coisa fina. Por exemplo:</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© ruim</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
if (count((array) $b->getQuery()->joins) > 0)
{
    ...
}
</pre>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© pior</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
// Verifica se a query possui joins
if (count((array) $b->getQuery()->joins) > 0)
{
    ...
}
</pre>
                <p>Por que √© pior? Voc√™ deve estar se perguntando, afinal, voc√™ est√° dizendo o que o c√≥digo faz.</p>
                <p>√â que coment√°rios em c√≥digos, podem esconder detalhes e ao longo do tempo, se essa declara√ß√£o for
                    modificada, ser√° que a pessoa que a modificou se dar√° o trabalho de alterar o coment√°rio? Nos meus
                    anos de pr√°tica nunca vi isso acontecer (talvez seja a bolha n√©?).</p>
                <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
if ($this->hasJoins()) 
{
    ...
}
</pre>
                <p>Viu como a declara√ß√£o fica t√£o √≥bvia ao ponto de ser bobo? N√£o precisei de nenhum coment√°rio
                    explicando o que significa a declara√ß√£o. O pr√≥pria nome j√° diz: <strong>hasJoins</strong>
                    (<strong>possuiLigacoes</strong> - em tradu√ß√£o livre).</p>
                <p>Pare hoje de colocar nome de vari√°vel como <i>x</i> ou <i>t</i>. Veja seu c√≥digo como um filho seu e
                    coloque bons nomes (a n√£o ser que tu seja o Elon Musk. Se for, ignore o coment√°rio anterior).</p>
                <p>Ainda sobre este t√≥pico vale ressaltar que o framework Laravel possui uma conven√ß√£o de nomes que
                    recomendo ser respeitada. Ela n√£o √© obrigat√≥ria, mas seu uso potencializar√° as comodidades que o
                    framework oferece como: Gera√ß√£o de c√≥digos usando o artisan cli; Acesso √† recursos sem a necessidade
                    de configura√ß√µes extras; e o mais importante, um padr√£o de escrita que se respeitado, beneficiar√°
                    toda a equipe no longo prazo, reduzindo a curva de aprendizagem e acelerando a gera√ß√£o de valor.</p>
                <table class="border-collapse border border-slate-400 mt-5">
                    <thead class="border border-slate-300">
                        <tr>
                            <th class="border border-slate-300 p-3">
                                <strong>Recurso</strong>
                            </th>
                            <th class="border border-slate-300 p-3"><strong>Qual a
                                    conven√ß√£o?</strong></th>
                            <th class="border border-slate-300 p-3"><strong>Isso aqui √©
                                    Ruim</strong></th>
                            <th class="border border-slate-300 p-3"><strong>Isso aqui √©
                                    Excelente</strong></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="border border-slate-300 p-3">Model</td>
                            <td class="border border-slate-300 p-3">singular</td>
                            <td class="border border-slate-300 p-3">Users</td>
                            <td class="border border-slate-300 p-3">User</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Propriedade de uma Model</td>
                            <td class="border border-slate-300 p-3">snake_case</td>
                            <td class="border border-slate-300 p-3">$model-&gt;createdAt</td>
                            <td class="border border-slate-300 p-3">$model-&gt;created_at</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Migra√ß√µes</td>
                            <td class="border border-slate-300 p-3">nome expressivo</td>
                            <td class="border border-slate-300 p-3">2017_01_01_000000_articles</td>
                            <td class="border border-slate-300 p-3">2017_01_01_000000_create_articles_table</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Tabelas</td>
                            <td class="border border-slate-300 p-3">plural</td>
                            <td class="border border-slate-300 p-3">article_comment, articleComments</td>
                            <td class="border border-slate-300 p-3">article_comments</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Colunas em tabelas</td>
                            <td class="border border-slate-300 p-3">snake_case sem o nome da model</td>
                            <td class="border border-slate-300 p-3">MetaTitle; article_meta_title</td>
                            <td class="border border-slate-300 p-3">meta_title</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Chaves prim√°rias</td>
                            <td class="border border-slate-300 p-3">-</td>
                            <td class="border border-slate-300 p-3">custom_id</td>
                            <td class="border border-slate-300 p-3">id</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Chaves estrangeiras</td>
                            <td class="border border-slate-300 p-3">singular com nome da model e com o sufixo _id</td>
                            <td class="border border-slate-300 p-3">ArticleId, id_article, articles_id</td>
                            <td class="border border-slate-300 p-3">article_id</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">relacionamentos hasOne ou belongsTo</td>
                            <td class="border border-slate-300 p-3">singular</td>
                            <td class="border border-slate-300 p-3">articleComments, article_comment</td>
                            <td class="border border-slate-300 p-3">articleComment</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Todos os outros relacionamentos</td>
                            <td class="border border-slate-300 p-3">plural</td>
                            <td class="border border-slate-300 p-3">articleComment, article_comments</td>
                            <td class="border border-slate-300 p-3">articleComments</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Tabela Pivot</td>
                            <td class="border border-slate-300 p-3">nomes das models no singular e em ordem alfab√©tica
                            </td>
                            <td class="border border-slate-300 p-3">user_article, articles_users</td>
                            <td class="border border-slate-300 p-3">article_user</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Collection</td>
                            <td class="border border-slate-300 p-3">descritiva e no plural</td>
                            <td class="border border-slate-300 p-3">$active, $data</td>
                            <td class="border border-slate-300 p-3">$activeUsers = User::active()-&gt;get()</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Controller</td>
                            <td class="border border-slate-300 p-3">singular</td>
                            <td class="border border-slate-300 p-3">ArticlesController</td>
                            <td class="border border-slate-300 p-3">ArticleController</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Route</td>
                            <td class="border border-slate-300 p-3">plural</td>
                            <td class="border border-slate-300 p-3">article/1</td>
                            <td class="border border-slate-300 p-3">articles/1</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Named route</td>
                            <td class="border border-slate-300 p-3">snake_case sem nota√ß√£o de ponto</td>
                            <td class="border border-slate-300 p-3">users.show-active, show-active-users</td>
                            <td class="border border-slate-300 p-3">users.show_active</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">M√©todos</td>
                            <td class="border border-slate-300 p-3">camelCase</td>
                            <td class="border border-slate-300 p-3">get_all</td>
                            <td class="border border-slate-300 p-3">getAll</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">M√©todos em controllers</td>
                            <td class="border border-slate-300 p-3">conven√ß√£o: store, view, list, update, destroy</td>
                            <td class="border border-slate-300 p-3">saveArticle</td>
                            <td class="border border-slate-300 p-3">store</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">M√©todos em classes de teste</td>
                            <td class="border border-slate-300 p-3">camelCase</td>
                            <td class="border border-slate-300 p-3">test_guest_cannot_see_article</td>
                            <td class="border border-slate-300 p-3">testGuestCannotSeeArticle</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Vari√°veis</td>
                            <td class="border border-slate-300 p-3">camelCase</td>
                            <td class="border border-slate-300 p-3">$articles_with_author</td>
                            <td class="border border-slate-300 p-3">$articlesWithAuthor</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Object</td>
                            <td class="border border-slate-300 p-3">descritiva no singular</td>
                            <td class="border border-slate-300 p-3">$users, $obj</td>
                            <td class="border border-slate-300 p-3">$activeUser = User::active()-&gt;first()</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Config e arquivos de linguagem</td>
                            <td class="border border-slate-300 p-3">snake_case</td>
                            <td class="border border-slate-300 p-3">ArticlesEnabled; articles-enabled</td>
                            <td class="border border-slate-300 p-3">articles_enabled</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">View</td>
                            <td class="border border-slate-300 p-3">kebab-case</td>
                            <td class="border border-slate-300 p-3">showFiltered.blade.php, show_filtered.blade.php
                            </td>
                            <td class="border border-slate-300 p-3">show-filtered.blade.php</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Config</td>
                            <td class="border border-slate-300 p-3">snake_case</td>
                            <td class="border border-slate-300 p-3">googleCalendar.php, google-calendar.php</td>
                            <td class="border border-slate-300 p-3">google_calendar.php</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Contract (interface)</td>
                            <td class="border border-slate-300 p-3">adjetivo ou substantivo</td>
                            <td class="border border-slate-300 p-3">AuthenticationInterface, IAuthentication</td>
                            <td class="border border-slate-300 p-3">Authenticatable</td>
                        </tr>
                        <tr>
                            <td class="border border-slate-300 p-3">Trait</td>
                            <td class="border border-slate-300 p-3">adjetivo</td>
                            <td class="border border-slate-300 p-3">NotificationTrait</td>
                            <td class="border border-slate-300 p-3">Notifiable</td>
                        </tr>
                    </tbody>
                </table>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left"
            data-card-name="nao-acesse-variaveis-de-ambiente-diretamento-pelo-env">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">N√£o
                acesse vari√°veis de ambiente diretamente pelo .env<span class="show-details text-gray-500 text-lg"
                    role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>Voc√™ deve estar se perguntando o porqu√™ n√£o pode simplesmente usar o helper <strong>env</strong>
                    diretamente. Isso est√° ligado √† estrat√©gia de caching que o Laravel usa para otimizar o acesso a
                    recursos. Uma vez que as configura√ß√µes foram armazenadas em cache, o helper <strong>env</strong> n√£o
                    retornar√° nada al√©m de <i>null</i>. Por isso a recomenda√ß√£o de configurar o acesso √† vari√°veis de
                    ambiente por meio do arquivo de configura√ß√£o.</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© ruim</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
$apiKey = env('API_KEY');
</pre>
                <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
// No arquivo de configura√ß√£o: config/api.php
'key' => env('API_KEY'),

// Acessando o valor
$apiKey = config('api.key');
</pre>
                <p>Ainda adiciono que configurar vari√°veis de ambiente em arquivos de configura√ß√£o, permitir√° um acesso
                    mais leg√≠vel √† informa√ß√£o, e voc√™ poder√° ter configura√ß√µes de natureza diferentes, organizadas em
                    dom√≠nios mais sem√¢nticos, como no caso acima, em que todas as informa√ß√µes relacionadas √† API estar√£o
                    em um arquivo espec√≠fico de configura√ß√µes de API.</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left"
            data-card-name="nao-acabe-com-a-memoria-use-chunk">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">N√£o
                acabe com a mem√≥ria! Use chunk<span class="show-details text-gray-500 text-lg"
                    role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>Se voc√™ √© iniciante na √°rea, talvez n√£o tenha se deparado com tarefas que exigiam implementa√ß√µes que
                    precisassem realizar processamentos em grandes volumes de informa√ß√µes, ou certamente, se nasceu nos
                    anos 2000, talvez nunca tenha desenvolvido algo e se preocupado com quanta mem√≥ria uma opera√ß√£o est√°
                    consumindo.</p>
                <p>Isso n√£o √© ruim n√£o. Ainda bem que hoje nossa preocupa√ß√£o hoje em dia seja mais com design de
                    arquitetura e capacidade de manuten√ß√£o do que detalhes de mais baixo n√≠vel (isso em √¢mbito geral),
                    se bem que performance e escalabilidade ainda s√£o assuntos relevantes e sempre ter√£o seu espa√ßo nas
                    discuss√µes dos profissionais da √°rea.</p>
                <p>Meu ponto aqui √© te dizer que com Laravel, quando tu precisar executar uma opera√ß√£o em grandes
                    volumes, cuidado, pois:</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© ruim</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
$users = User::where('active', 1)->get(); // Suponha que h√° 10 mil usu√°rios

$users->each(function($user){
    // Envie um e-mail
});
</pre>
                <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
User::where('active', 1)
->chunkById(200, function ($users) {
    $users->each(function($user){
                // Envie um e-mail
            });
}, $column = 'id');
</pre>
                <p>Veja que na fun√ß√£o acima, √© invocada uma fun√ß√£o chamada <strong>chunkById</strong> que recebe como
                    par√¢metros: O n√∫mero de resultados recuperados por itera√ß√£o; e um callback para processar os
                    resultados.</p>
                <p>Isso vai permitir consumir menos mem√≥ria do que executar um eager loading retornando todos os itens
                    da tabela como na primeira op√ß√£o, uma vez que a execu√ß√£o ser√° executada em lotes de <strong>200
                        resultados por consulta</strong>, conforme o exemplo apresentado.</p>
                <p>Se voc√™ pesquisar na documenta√ß√£o oficial ver√° que h√° ainda uma fun√ß√£o <strong>chunk</strong> que
                    pode ser usada. N√£o a utilizei no exemplo acima, porque como realizei um filtro na consulta, a
                    fun√ß√£o <strong>chunkById</strong> realiza um trabalho melhor, uma vez que usa a coluna ID para
                    identificar o √∫ltimo item retornado na consulta anterior e em ordem crescente ser√° o ponto de
                    partida da pr√≥xima consulta.</p>
                <p>De quebra, ainda usei a fun√ß√£o <strong>each</strong> que possui uma legibilidade melhor que escrever
                    uma declara√ß√£o <strong>foreach</strong>, embora isso tenha haver apenas com legibilidade e n√£o com
                    performance, ou algo dessa natureza.</p>
                <p>E para fechar, certamente se voc√™ √© algu√©m com um conhecimento um pouco mais avan√ßado, deve estar se
                    perguntando: <i>‚ÄúPor que ele n√£o falou que os resultados poderiam ser executados em uma fila?‚Äù</i>.
                    E sim, poderiam, isso faria sentido na execu√ß√£o do comando (enviar o e-mail, conforme proposto no
                    exemplo). Voc√™ pode configurar uma fila de envio de e-mails e ao inv√©s de realizar a opera√ß√£o de
                    envio de forma s√≠ncrona, um por um, voc√™ pode enfileirar as opera√ß√µes para que aconte√ßam de forma
                    ass√≠ncrona.</p>
                <blockquote class="border-l-4 border-red-400 bg-gray-200 my-2 p-3 italic">
                    Pesquise na documenta√ß√£o do Laravel as fun√ß√µes: <strong>lazy</strong> e <strong>lazyById</strong> ,
                    pois elas internamente usam a mesma estrat√©gia de <strong>chunk</strong>, por√©m retornam uma
                    <strong>LazyCollection</strong> que te permite interagir com os resultados individualmente. Por
                    exemplo: <strong>foreach (User::lazy() as $user) { ... }</strong>
                </blockquote>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left"
            data-card-name="seja-esperto-use-acessors-e-mutators">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Seja
                esperto! Use acessors e mutators<span class="show-details text-gray-500 text-lg"
                    role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>Falei que evitaria criar rela√ß√µes diretas entre os t√≥picos para serem um guia de bolso para consultas
                    r√°pidas, mas esse √© um assunto que conversa bem com o t√≥pico em que discutimos o <i>‚ÄúN√£o se
                        Repita‚Äù</i>.</p>
                <p>Isso porque, <strong>acessors</strong> e <strong>mutators</strong> foram implementados no Laravel
                    justamente para melhorar o seu dia-a-dia e evitar que fique reescrevendo coisas verbosas o tempo
                    todo em tudo quanto √© lugar, veja:</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© ruim</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
// Aqui seria uma p√°gina Blade
{{ Carbon::createFromFormat('Y-d-m H-i', $product->ordered_at)->format('m-d') }}
</pre>
                <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
protected function orderedAt(): Attribute
{
    return Attribute::make(
        get: fn ($value) => 
                    Carbon::createFromFormat(
                        'Y-d-m H-i',
                        $value
                    )->format('m-d'),
    );
}

// Quando for usar, o atributo j√° estar√° formatado, 
// pois o Acessor j√° fez o trabalho pesado
{{ $product->ordered_at }}
</pre>
                <p>Se voc√™ estiver seguindo as conven√ß√µes de nomes do Laravel, isso funcionar√° como mostrei acima, pois
                    entende-se que a fun√ß√£o <strong>orderedAt</strong> dentro da model <strong>Product</strong>
                    refere-se ao atributo <strong>ordered_at</strong>. Caso voc√™ queira criar um acessor com nome de
                    fun√ß√£o personalizada, com mais sem√¢ntica, fa√ßa desse jeito:</p>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3 mt-3">
protected function orderedAtPtBrFormat(): Attribute
{
    return Attribute::make(
        get: fn ($value, $attributes) => 
                    Carbon::createFromFormat(
                        'Y-d-m H-i', 
                        $attributes['ordered_at']
                    )->format('d-m-Y H-i'),
    );
}
</pre>
                <h4 class="text-xl my-3 font-bold">Mas qual a diferen√ßa entre um Acessor e um Mutator?</h4>
                <p>A diferen√ßa √© que um Acessor, ir√° formatar o valor antes de exib√≠-lo e n√£o ir√° alterar o registro
                    original, uma vez que seu √∫nico objetivo √© permitir abstrair as apresenta√ß√µes de dados.</p>
                <p>J√° um Mutator, √© o contr√°rio, seu papel √© formatar a informa√ß√£o para armazenar no banco. Vamos supor
                    que voc√™ salva as datas no seu banco no formato <i>Y-m-d</i>, por√©m, o formul√°rio no front-end do
                    seu sistema envia a informa√ß√£o no formato <i>d-m-Y</i>. Neste caso, o Mutator vai ser usado para
                    preparar a data antes de salv√°-la no banco. Veja:</p>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3 mt-3">
protected function orderedAt(): Attribute
{
    return Attribute::make(
        set: fn ($value) => 
                Carbon::createFromFormat(
                    'd-m-Y',
                    $value
                )->format('Y-m-d'),
    );
}
</pre>
                <p>Se olhar com aten√ß√£o, os acessors s√£o definidos como um callback de get e mutators s√£o definidos como
                    um callback de <strong>set</strong> que s√£o atributos da classe <strong>Attribute</strong> que
                    abstrai o tratamento customizado de atributos no Laravel.</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left"
            data-card-name="um-blade-sem-consultas-por-favor">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Um
                Blade sem consultas, por favor<span class="show-details text-gray-500 text-lg"
                    role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>Evite inserir consultas em arquivos blade, pois eles s√£o respons√°veis apenas pela camada de
                    apresenta√ß√£o. Mover consultas para essa camada, cria acoplamentos desnecess√°rios, sem falar que voc√™
                    estar√° espalhando l√≥gica de neg√≥cio para tudo quanto √© lado. Tenha bom senso üò∫</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© horr√≠vel</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
@foreach (User::all() as $user)
    {{ $user->profile->name }}
@endforeach
</pre>
                <p>Por que √© horr√≠vel? Al√©m do motivo que abriu a discuss√£o do t√≥pico, a consulta acima faz <strong>N +
                        1 consultas (famoso problema N + 1)</strong>, ou seja, se tu for listar os <i>perfis de 100
                        usu√°rios, ser√£o 101 consultas</i>.</p>
                <blockquote class="border-l-4 border-red-400 bg-gray-200 my-2 p-3 italic">
                    Agora imagine essa p√°gina sendo acessada por mil pessoas. Esse a√≠ seria um claro gargalo de
                    performance.
                </blockquote>
                <p>Mas falando s√©rio, evite esse tipo de c√≥digo.</p>
                <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
// Na controller
$users = User::with('profile')->get();

// No blade

@foreach ($users as $user)
    {{ $user->profile->name }}
@endforeach
</pre>
                <p>Veja que o blade template s√≥ sabe que existem usu√°rios com perfis para apresentar, n√£o sabe a regra
                    aplicada na filtragem, ou qualquer outra regra, e‚Ä¶ s√£o apenas 2 consultas.</p>
                <h4 class="text-xl my-3 font-bold">Como assim, N + 1?</h4>
                <p>Em uma vis√£o mais simplificada do problema, tente visualizar o seguinte cen√°rio:</p>
                <ul class="list-disc pl-6">
                    <li>Voc√™ possui uma base com 100 usu√°rios;</li>
                    <li>Voc√™ vai acessar uma p√°gina que exibe o nome do perfil de cada usu√°rio (rela√ß√£o 1:N);</li>
                    <li>Por debaixo dos panos, o que o exemplo N + 1 faz √©:</li>
                </ul>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
SELECT * FROM users;
SELECT * FROM profiles WHERE user_id = 1;
SELECT * FROM profiles WHERE user_id = 2;
SELECT * FROM profiles WHERE user_id = 3;
...
SELECT * FROM profiles WHERE user_id = 100;
</pre>
                <p>Porque ele primeiro pega a refer√™ncia de usu√°rios em 1 consulta e a do perfil nas outras 100.</p>
                <p>No segundo caso, ele faz uma consulta para retornar os usu√°rios e uma segunda consulta que permitir√°
                    retornar os dados do perfil, dessa forma:</p>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
SELECT * FROM users;   
SELECT * FROM profiles WHERE user_id in (1, 2, 3, 4, 5, ...)
</pre>
                <p>Isso porque a fun√ß√£o <strong>all</strong> vai retornar todos os usu√°rios de uma vez, e toda vez que
                    no loop voc√™ acessar a vari√°vel <strong>profile</strong> ser√° feita uma nova consulta para pegar a
                    informa√ß√£o de perfil do usu√°rio. A fun√ß√£o <strong>with</strong> usa a estrat√©gia de eager loading,
                    que exemplifiquei acima, por isso s√£o realizadas apenas 2 consultas.</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left"
            data-card-name="use-atribuicao-em-massa">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Use
                atribui√ß√£o em massa<span class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>Quando passar dados de uma requisi√ß√£o para uma model realizar um novo registro, tire proveito das
                    conven√ß√µes de nomes, e fa√ßa uma atribui√ß√£o em massa, que basicamente vai parametrizar os atributos
                    de requisi√ß√£o e refletir nos atributos da model.</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© ruim</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
$post = new Post;
$post->title = $request->title;
$post->content = $request->content;
$post->verified = $request->verified;
$post->save();
</pre>
                <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
                <pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
$post->create($request->all());
</pre>
                <p>Isso reduz muito a quantidade de linhas escritas, sem perder a legibilidade.</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left"
            data-card-name="referencias">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">
                Refer√™ncias<span class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-6 mt-5 text-lg hidden" role="contentinfo">
                <ul class="list-disc">
                    <li><a href="https://laravel.com/docs/9.x/installation">Documenta√ß√£o oficial do Laravel</a></li>
                    <li><a href="https://github.com/jonaselan/laravel-best-practices">Laravel best practices</a></li>
                    <li>Clean Code: A Handbook of Agile Software Craftsmanship. Martin, R.C. 9780132350884. 2009.
                        Prentice Hall</li>
                </ul>
            </article>
        </section>
    </main>
    <script>
        const CardView = {
            card: null,
            toggleButton: null,
            init(element) {
                this.card = element;
                this.toggleButton = this.card.querySelector('.show-details');
                this.toggleButton.addEventListener('click', this.toggleDetails.bind(this));
                return this;
            },
            toggleDetails() {
                const details = this.card.querySelector('.details')
                if (details.classList.value.includes('hidden')) {
                    details.classList.remove('hidden');
                    this.toggleButton.innerText = 'ocultar';
                    return;
                }
                this.toggleButton.innerText = 'exibir';
                details.classList.add('hidden');
            }
        };

        const cards = new Map();

        document.querySelectorAll('.collapsible-card').forEach(el => {
            const view = Object.create(CardView);
            cards.set(el.getAttribute("data-card-name"), view.init(el))
        });

    </script>
</body>

</html>