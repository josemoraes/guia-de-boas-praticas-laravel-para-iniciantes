<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia de Boas Pr√°ticas - Laravel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Anton&family=Nunito+Sans:wght@300;400;900&family=Ubuntu:wght@300;400;700&display=swap"
        rel="stylesheet">
    <style>
        * {
            font-family: 'Nunito Sans', sans-serif;
        }
    </style>
</head>
<body class="py-10 bg-gray-100 flex flex-col items-center justify-center">
    <header class="w-8/12">
        <h1 class="text-5xl font-bold text-red-500">Guia de Boas Pr√°ticas com Laravel</h1>
        <h2 class="text-2xl font-bold text-gray-500">( para iniciantes )</h2>
    </header>
    <main class="w-8/12">
        <section class="my-10">
            <article class="text-lg leading-relaxed">
                <p>Ol√°, Dev!</p>
                <p>Suponho que voc√™ seja um iniciante na √°rea de programa√ß√£o. Logo, me arrisco a dizer que na maior parte do tempo em que voc√™ est√° dedicado √† aprender mais sobre a √°rea, est√° sempre √† procura de qual a nova tend√™ncia, ferramenta, ou tecnologia precisa aprender para conseguir se destacar.</p>
                <p>E se te disser que isso √© besteira?</p>
                <p>Com o passar dos anos, a experi√™ncia e a exposi√ß√£o √† ambientes desafiadores te mostram que os fundamentos s√£o muito mais importantes que qualquer nova tend√™ncia atual.</p>
                <p>Manter um software √© muito mais trabalhoso, do que criar um do zero. Talvez seja por isso, que tenho certeza que j√° deve ter ouvido, ou dito algo parecido com: </p>
                <blockquote class="border-l-4 border-red-400 bg-gray-200 my-2 p-3 italic">‚ÄúE se a gente refizesse isso com <strong>[coloque aqui qual a tecnologia da moda]</strong>?‚Äù</blockquote>
                <p>No que Eu acredito? Que software bom, √© aquele que √© usado. Tecnologia boa √© qualquer uma que resolve o seu problema, ali√°s, o que √© uma linguagem, ou framework sen√£o mais uma ferramenta no que deveria ser a sua caixa de ferramentas? </p>
                <blockquote class="border-l-4 border-red-400 bg-gray-200 my-2 p-3 italic">Acredito que o bom c√≥digo √© aquele que possui uma leitura e entendimento simples e √≥bvio. Que permita uma f√°cil manuten√ß√£o e evolu√ß√£o.</blockquote>
                <p>Por isso, esse material ser√° focado em ajudar voc√™, desenvolvedor Laravel, a parar de buscar alternativas em outras linguagens, ou frameworks, sem antes ter explorado o que o Laravel tem de melhor a te oferecer. Construindo softwares com alta manutenabilidade e extensibilidade.</p>
                <p>Portanto, o conte√∫do que voc√™ vai encontrar aqui ser√° claro e direto. Voc√™ dever√° us√°-lo como mais uma ferramenta no seu arsenal. Sendo assim, voc√™ pode acessar diretamente as se√ß√µes de interesse, sem ter que ler as anteriores.</p>
                <p>Meu objetivo √© que Voc√™ seja visto como um excelente profissional, que aplica boas pr√°ticas e escreve um c√≥digo com alto n√≠vel de manutenabilidade.</p>
            </article>
            <article class="border-l-4 border-red-400 bg-gray-200 my-2 p-3 leading-relaxed">
                <h3 class="text-xl font-bold">Quem criou essa p√°gina?</h3>
                <p>Ol√°, me chamo Jos√© Moraes e j√° atuo na √°rea de software h√° alguns anos.</p>
                <p>Caso tenha interesse em saber mais sobre mim, recomendo se conectar comigo pelo LinkedIn e visitar meu Github</p>
                <ul class="mt-3 flex flex-row">
                    <li><a href="https://www.linkedin.com/in/josecarlosfilho/" class="bg-blue-600 px-3 py-2 border-2 border-blue-500 rounded text-white font-bold mr-3 block w-28 text-center">LinkedIn</a></li>
                    <li><a href="https://github.com/josemoraes" class="bg-black px-3 py-2 border-2 border-gray-800 rounded text-white font-bold block w-28 text-center">Github</a></li>
                </ul>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left" data-card-name="sua-responsabilidade-e-uma-so">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Sua responsabilidade √© uma s√≥<span
                class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>J√° ouviu aquele ditado: <i>‚ÄúQuem faz tudo, n√£o faz nada bem feito‚Äù</i>?</p>
                <p>Pois √©, o famoso <strong>Princ√≠pio de Responsabilidade √önica</strong> trata justamente disso. Suas classes e fun√ß√µes devem ter uma √∫nica responsabilidade. Ao fazer isso, a escrita de testes fica mais f√°cil, e o processo de ‚Äúdebuga√ß√£o‚Äù tamb√©m.</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© ruim</h4>
<pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
protected function fullClientName(): Attribute
{
    if (auth()->user() && auth()->user()->hasRole('client') && auth()->user()->isVerified()) {
        return new Attribute(
            get: fn ($value, $attributes) => "Sr. $attributes['first_name'] $attributes['middle_name'] $attributes['last_name']",
        );
    } else {
        return new Attribute(
            get: fn ($value, $attributes) => "$attributes['first_name'] $attributes['last_name']",
        );
    }
}
</pre>
                <p>Os problemas do c√≥digo acima s√£o:</p>
                <ul class="list-disc pl-6">
                    <li>Muito verboso. Parece bagun√ßado; e</li>
                    <li>Em uma breve leitura voc√™ percebe que ele valida se o usu√°rio est√° ‚Äúlogado‚Äù, se seu papel √© <i>client</i> e se ele est√° verificado. O que n√£o tem nada haver com o nome do cliente;</li>
                </ul>
                <p>√Ä partir do momento em que o c√≥digo faz mais do que apenas retornar o nome do usu√°rio (que √© o que diz o nome da fun√ß√£o), o c√≥digo esconde de quem o chama, regras de neg√≥cio que n√£o tem nada haver com o que o consumidor da fun√ß√£o (uma outra classe por exemplo) espera. Na verdade, isso afetaria at√© a escrita de testes unit√°rios, uma vez que a estrat√©gia de defini√ß√£o de como ser√° retornado o nome est√° escondida dentro da fun√ß√£o.</p>
                <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
<pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
protected function fullClientName() : Attribute
{
    return new Attribute(
            get: fn ($value, $attributes) => "Sr. $attributes['first_name'] $attributes['middle_name'] $attributes['last_name']",
        );
}

protected function shortClientName() : Attribute
{
    return new Attribute(
            get: fn ($value, $attributes) => "$attributes['first_name'] $attributes['last_name']",
        );
}

public function isTheLoggedUserAVerifiedClient()
{
    return  auth()->user() && 
            auth()->user()->hasRole('client') && 
            auth()->user()->isVerified()	
}

public function getUserData() 
{
    // Essa seria uma fun√ß√£o qualquer que consumiria as demais
    $name = $user->isTheLoggedUserAVerifiedClient() 
                ? $user->full_client_name 
                : $user->short_client_name;

    return new UserDTO($name, ...);
}
</pre>
                <p>Veja que nessa segunda abordagem, √© retornado exatamente o valor que a fun√ß√£o <i>getUserData</i> espera quando pede pelo nome longo do cliente (<i>full_client_name</i>), ou a vers√£o curta dele (<i>short_client_name</i>). √â a fun√ß√£o chamadora quem define se quer exibir o nome curto, ou completo. Dessa forma, nenhuma regra de neg√≥cio fica oculta dentro de um m√©todo que s√≥ deveria retornar um nome na vers√£o longa, ou curta.</p>
                <p>Uma dica √© sempre usar nomes descritivos, que realmente digam o que a fun√ß√£o/classe faz. Desse jeito, se voc√™ notar que o nome atribu√≠do come√ßa a ficar longo e dizer que faz mais do que o que voc√™ pensa que ela deveria fazer, isso √© sintoma de que o c√≥digo em quest√£o est√° ferindo o <strong>Princ√≠pio de Responsabilidade √önica</strong>.</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left" data-card-name="controllers-devem-ser-finas">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Controllers devem ser "finas"<span
                class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>Existe uma express√£o na comunidade Laravel que diz (em tradu√ß√£o livre):</p>
                <blockquote class="border-l-4 border-red-400 bg-gray-200 my-2 p-3 italic">Tenha models ‚Äúgordos‚Äù e controllers ‚Äúfinos‚Äù</blockquote>
                <p>Na pr√°tica, isso quer dizer que voc√™ n√£o deve ter regras de neg√≥cio, nem consultas de banco nas suas controllers.</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© ruim</h4>
<pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
public function index()
{
    $users = User::verified()
        ->with(['posts' => function ($q) {
            $q->where('created_at', '>', Carbon::today()->subWeek());
        }])
        ->get();

    return view('index', ['users' => $users]);
}
</pre>
                <p>Veja que toda a defini√ß√£o de consulta est√° definida na controller. Isso √© p√©ssimo, pois cruza as fronteiras de responsabilidade de uma controller, que deve apenas direcionar a model/regra de neg√≥cio que ser√° entregue para a camada de apresenta√ß√£o.</p>
                <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
<pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
// Na Controller
public function index()
{
    return view('index', ['users' => $this->user->getWithNewPosts()]);
}

// Na Model
class Client extends Model
{
    public function getWithNewPosts()
    {
        return $this->verified()
            ->with(['posts' => function ($q) {
                $q->where('created_at', '>', Carbon::today()->subWeek());
            }])
            ->get();
    }
}
</pre>
                <p>Perceba que agora a controller apenas indica que os usu√°rios a serem apresentados devem possuir os <i>posts</i> mais recentes, sem se importar como isso √© feito na model.</p>
                <p>Isso vai manter seu c√≥digo muito mais organizado e leg√≠vel.</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left" data-card-name="valide-suas-requisicoes-do-jeito-certo">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Valide suas requisi√ß√µes do jeito certo<span
                class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>Se voc√™ estiver validando as requisi√ß√µes diretamente na controller, pare agora mesmo. Lembre-se: <i>‚ÄúControllers sempre finas‚Äù</i>. Portanto:</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© ruim</h4>
<pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
public function store(Request $request)
{
    $request->validate([
        'name' => 'required|max:255',
        'description' => 'required'
    ]);
    ...
}
</pre>
            <p>A classe <i>Request</i> pode ser estendida e customizada para que contenha as valida√ß√µes que deseja fazer.</p>
            <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
<pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
// Crie a classe para extender Request e tratar as valida√ß√µes
class ProductRequest extends Request
{
    public function rules()
    {
        return [
            'name' => 'required|max:255',
                'description' => 'required'
        ];
    }
}

// Aqui √© na classe de Controller
public function store(ProductRequest $request)
{
    ....
}
</pre>
                <p>Agora sim üòÉ</p>
                <p>Veja que as regras agora s√£o definidas dentro da fun√ß√£o <i>rules</i> da classe <i>ProductRequest</i> e o pr√≥prio middleware as executa antes de passar a requisi√ß√£o para a controller em si. Se alguma regra for ferida, o middleware disparar√° uma exce√ß√£o.</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left" data-card-name="ja-diziam-os-menudos-nao-se-repita">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">J√° diziam os Menudos: "N√£o se repita"<span
                class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>Tenho certeza que essa m√∫sica vai ficar na sua cabe√ßa pelo resto do seu dia: <i>‚ÄúN√£o se repita, n√£o se repita (‚Ä¶)‚Äù</i>.</p>
                <p>O conceito de DRY (Dont Repeat Yourself - N√£o se Repita) parece √≥bvio, ali√°s, quem gosta de escrever o mesmo c√≥digo em v√°rios lugares diferentes, sem reaproveitar nada? ü§®</p>
                <p>Desculpa estragar seu sorrisinho de canto de boca, mas <strong>CTRL + C</strong> e <strong>CTRL + V</strong> n√£o √© bem reaproveitamento de c√≥digo no conceito DRY.</p>
                <p>A verdade √© que <i>‚ÄúN√£o se Repetir‚Äù</i> aqui √© abstrair alguma l√≥gica em um escopo com fronteiras bem definidas e acessar esse escopo por uma inst√¢ncia dele. Veja:</p>
                <h4 class="text-xl my-3 font-bold">Isso aqui √© ruim</h4>
<pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
public function getActive()
{
    return $this->where('verified', 1)->get();
}

public function getPosts()
{
    return $this->whereHas('user', function ($q) {
            $q->where('verified', 1);
        })->get();
}
</pre>
                <p>Veja que nas duas fun√ß√µes, √© feita uma query para verificar se o usu√°rio foi verificado.</p>
                <h4 class="text-xl my-3 font-bold">Como melhorar isso?</h4>
<pre class="whitespace-pre-wrap bg-gray-700 text-white px-5 py-3 mb-3">
public function scopeVerified($q)
{
    return $q->where('verified', 1);
}

public function getActive()
{
    return $this->verified()->get();
}

public function getArticles()
{
    return $this->whereHas('user', function ($q) {
            $q->verified();
        })->get();
}
</pre>
                <p>Veja que aqui, usei o conceito de query scopes (escopos de consulta) do Eloquent ORM usado pelo Laravel, e abstra√≠ a l√≥gica de consulta que aplica o filtro de usu√°rio verificado e apenas reaproveitei o uso do escopo nas demais fun√ß√µes.</p>
                <p>Vale lembrar que aqui s√≥ usei o conceito de query scopes, para aproveitar a oportunidade de mostrar como eles funcionam e explicar o conceito ao mesmo tempo, por√©m, o conceito de DRY deve ser aplicado toda vez que voc√™ perceber que um mesmo trecho de c√≥digo est√° sendo usado em outros lugares. Se voc√™ estiver fazendo muito <strong>CTRL + C</strong> e <strong>CTRL + V</strong> de um trecho de c√≥digo, certamente √© uma oportunidade clara de aplicar o DRY.</p>
                <p>Fique sempre atento e refatore quando necess√°rio.</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left" data-card-name="coloque-um-nome-decente">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Coloque um nome decente!<span
                class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>logo mais</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left" data-card-name="nao-acesse-variaveis-de-ambiente-diretamento-pelo-env">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">N√£o acesse vari√°veis de ambiente diretamente pelo .env<span
                class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>logo mais</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left" data-card-name="nao-acabe-com-a-memoria-use-chunk">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">N√£o acabe com a mem√≥ria! Use chunk<span
                class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>logo mais</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left" data-card-name="seja-esperto-use-acessors-e-mutators">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Seja esperto! Use acessors e mutators<span
                class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>logo mais</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left" data-card-name="um-blade-sem-consultas-por-favor">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Um Blade sem consultas, por favor<span
                class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>logo mais</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left" data-card-name="use-atribuicao-em-massa">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Use atribui√ß√£o em massa<span
                class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-3 mt-5 text-lg hidden" role="contentinfo">
                <p>logo mais</p>
            </article>
        </section>
        <section class="collapsible-card bg-white border-2 border-gray-200 rounded mt-3 p-7 text-left" data-card-name="use-atribuicao-em-massa">
            <h3 class="text-2xl text-red-500 font-bold border-bottom flex flex-row items-center justify-between">Refer√™ncias<span
                class="show-details text-gray-500 text-lg" role="button">exibir</span></h3>
            <article class="details pl-6 mt-5 text-lg hidden" role="contentinfo">
                <ul class="list-disc">
                    <li><a href="https://laravel.com/docs/9.x/installation">Documenta√ß√£o oficial do Laravel</a></li>
                    <li><a href="https://github.com/jonaselan/laravel-best-practices">Laravel best practices</a></li>
                    <li>Clean Code: A Handbook of Agile Software Craftsmanship. Martin, R.C. 9780132350884. 2009. Prentice Hall</li>
                </ul>
            </article>
        </section>
    </main>
    <script>
        const CardView = {
            card: null,
            toggleButton: null,
            init(element) {
                this.card = element;
                this.toggleButton = this.card.querySelector('.show-details');
                this.toggleButton.addEventListener('click', this.toggleDetails.bind(this));
                return this;
            },
            toggleDetails() {
                const details = this.card.querySelector('.details')
                if (details.classList.value.includes('hidden')) {
                    details.classList.remove('hidden');
                    this.toggleButton.innerText = 'ocultar';
                    return;
                }
                this.toggleButton.innerText = 'exibir';
                details.classList.add('hidden');
            }
        };
    
        const cards = new Map();
    
        document.querySelectorAll('.collapsible-card').forEach(el => {
            const view = Object.create(CardView);
            cards.set(el.getAttribute("data-card-name"), view.init(el))
        });
    
    </script>
</body>
</html>